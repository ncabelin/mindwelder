{% extends "base.html" %}
{% block content %}
<!-- Google Login -->
<script src="//apis.google.com/js/platform.js?onload=start"></script>

<div class="container">
  <div class="row">
    <div class="col-md-6 col-md-offset-3 bordered">
      <form method="POST" class="form-box">
      <h1 class="text-center">Login</h1>
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" name="username" id="username" class="form-control" value="{{ username }}">
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" name="password" id="password" class="form-control">
        </div>
        <div class="checkbox">
          <label for="remember"><input type="checkbox" name="remember">Remember me</label>
        </div>
        <button type="submit" class="btn btn-primary btn-lg">Submit</button><br>
        <p class="text-center">or</p>
        <div id="signInButton" class="text-center">
        <span class="g-signin"
          data-scope="openid email"
          data-clientid="220557527862-3oj41ohnsr4htgvtcbbohad9inrhgv8h.apps.googleusercontent.com"
          data-redirecturi="postmessage"
          data-accesstype="offline"
          data-cookiepolicy="single_host_origin"
          data-callback="signInCallback"
          data-approvalprompt="force">
        </span>
      	</div>
        <br><br>
        <br>
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6">
              <a href="/forgot" class="sub_menu">Forgot password</a><br><br>
            </div>
            <div class="col-md-6">
              <a href="/signup" class="sub_menu">Signup for a free account</a>
            </div>
          </div>
        </div>
      </form>
        <br><br>
        <div id="result"></div>
    </div>
  </div>
</div>
<script>
function signInCallback(authResult) {
	if (authResult.code) {
		$.ajax({
			type: 'POST',
			url: '/gconnect?state={{ state }}',
			processData: false,
			data: authResult.code,
			contentType: 'application/octet-stream; charset=utf-8',
			success: function(result) {
				if (result) {
					$('#result').html(result);
					setTimeout(function() {
						window.location.href = "/showuser";
					}, 3000);
				} else if (authResult.error) {
					console.log('There was an error: ' + authResult.error);
				} else {
					$('#result').html('Failed to make a server-side call. Check your configuration and console.');
				}
			}
		});
	}
}
</script>
{% endblock %}